#!/usr/bin/env bash

# This script runs the official ML4W setup script to catch any missing dependencies
# or system configurations (fonts, cursors, etc.) that aren't in standard packages.

ML4W_SETUP_DIR="{{ .chezmoi.sourceDir }}/.external_sources/dotfiles/setup"

echo ":: ML4W CHEZMOI HOOK ::"
echo ":: Checking for ML4W Setup Script at: $ML4W_SETUP_DIR"

if [ -d "$ML4W_SETUP_DIR" ]; then
    cd "$ML4W_SETUP_DIR" || exit 1

    # Fix permissions just in case
    chmod +x *.sh

    echo ":: Starting ML4W Setup..."
    echo ":: NOTE: This script may ask for confirmation (gum confirm). Please authorize it."
    
    # We run setup-arch.sh. 
    # NOTE: The upstream script uses 'gum confirm' which requires interaction.
    # We try to pipe 'yes' to it, but 'gum' is interactive-only. 
    # If this hangs, you must press ENTER in the terminal running chezmoi.
    
    ./setup-arch.sh
else
    echo ":: ERROR: ML4W setup directory not found. Did the submodules clone correctly?"
    exit 1
fi
